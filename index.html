<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoliStanze Lecco - Trova la tua stanza</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-storage.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .hero-bg { background-color: #1e3a8a; background-image: linear-gradient(145deg, #1e3a8a 0%, #3b82f6 100%); }
        .nav-link.active { color: #2563eb; font-weight: 600; }
        [id^="view-"] { display: none; }
        [id^="view-"].active { display: block; }
        .form-step { display: none; }
        .form-step.active { display: block; }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <header class="bg-white shadow-sm sticky top-0 z-40">
        <nav class="container mx-auto px-4 lg:px-8 flex justify-between items-center py-4">
            <div class="text-2xl font-bold text-blue-800">Poli<span class="text-blue-500">Stanze</span></div>
            <div class="hidden md:flex items-center space-x-6" id="nav-links">
                <a href="#search" class="nav-link active">Cerca</a>
                <a href="#create-listing" class="nav-link">Pubblica Annuncio</a>
                <a href="#profile" class="nav-link">Profilo</a>
                <a href="#my-home" class="nav-link">Casa Mia</a>
            </div>
            <div>
                <button id="login-btn" class="bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-blue-700 transition">Accedi</button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 lg:px-8 py-8 md:py-12">

        <div id="view-search" class="active">
            <section class="text-center rounded-xl hero-bg text-white py-20 px-6 mb-12 shadow-xl">
                 <h1 class="text-4xl md:text-5xl font-bold mb-4">Trova la tua stanza a Lecco</h1>
                 <p class="text-lg md:text-xl max-w-3xl mx-auto mb-8 text-blue-100">La piattaforma esclusiva per gli studenti del Politecnico.</p>
            </section>
            <div class="bg-white p-6 rounded-xl shadow-md mb-6">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">Esplora gli alloggi</h2>
                <p class="text-stone-600">Utilizza i filtri per trovare la soluzione perfetta per te.</p>
            </div>
            <div id="grid-view" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Annunci caricati da JS -->
            </div>
        </div>
        
        <div id="view-create-listing">
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-md mb-6 max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold text-stone-800 mb-2">Crea un nuovo annuncio</h2>
                <p class="text-stone-600 mb-6">Segui i passaggi per pubblicare il tuo alloggio sulla nostra piattaforma.</p>
                
                <form id="create-listing-form">
                    <!-- Step 1: Info Base -->
                    <div class="form-step active" id="step1">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">1. Informazioni di base</h3>
                        <div class="mb-4">
                            <label for="ad-title" class="block text-sm font-medium text-gray-700 mb-1">Titolo dell'annuncio</label>
                            <input type="text" id="ad-title" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Es. Stanza singola luminosa vicino al campus">
                        </div>
                        <div class="mb-4">
                            <label for="ad-description" class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
                            <textarea id="ad-description" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Descrivi l'alloggio, le sue caratteristiche e le regole della casa..."></textarea>
                        </div>
                        <div class="flex justify-end">
                            <button type="button" class="next-step-btn bg-blue-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-blue-700">Avanti</button>
                        </div>
                    </div>

                    <!-- Step 2: Dettagli e Prezzo -->
                    <div class="form-step" id="step2">
                         <h3 class="text-xl font-semibold mb-4 border-b pb-2">2. Dettagli e Prezzo</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="ad-type" class="block text-sm font-medium text-gray-700 mb-1">Tipologia</label>
                                <select id="ad-type" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                    <option>Stanza Singola</option>
                                    <option>Stanza Doppia</option>
                                    <option>Monolocale</option>
                                    <option>Appartamento</option>
                                </select>
                            </div>
                             <div>
                                <label for="ad-price" class="block text-sm font-medium text-gray-700 mb-1">Prezzo mensile (€)</label>
                                <input type="number" id="ad-price" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="450">
                            </div>
                        </div>
                        <div class="mb-4">
                             <label class="block text-sm font-medium text-gray-700 mb-2">Servizi inclusi</label>
                             <div class="flex flex-wrap gap-4">
                                <div><input type="checkbox" id="ad-wifi" class="accent-blue-600 mr-2 rounded"><label for="ad-wifi">Wi-Fi</label></div>
                                <div><input type="checkbox" id="ad-washing" class="accent-blue-600 mr-2 rounded"><label for="ad-washing">Lavatrice</label></div>
                                <div><input type="checkbox" id="ad-bills" class="accent-blue-600 mr-2 rounded"><label for="ad-bills">Spese Incluse</label></div>
                             </div>
                        </div>
                        <div class="flex justify-between">
                            <button type="button" class="prev-step-btn bg-gray-200 text-gray-800 font-semibold px-6 py-2 rounded-lg hover:bg-gray-300">Indietro</button>
                            <button type="button" class="next-step-btn bg-blue-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-blue-700">Avanti</button>
                        </div>
                    </div>

                     <!-- Step 3: Foto -->
                    <div class="form-step" id="step3">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">3. Carica le Foto</h3>
                        <div class="mb-4 p-6 border-2 border-dashed border-gray-300 rounded-lg text-center">
                            <label for="ad-photos" class="cursor-pointer text-blue-600 font-semibold">Clicca qui per selezionare le immagini</label>
                            <input type="file" id="ad-photos" multiple accept="image/*" class="hidden">
                             <p class="text-xs text-gray-500 mt-2">Puoi caricare più foto. La prima sarà l'immagine di copertina.</p>
                        </div>
                        <div id="photo-preview" class="grid grid-cols-3 gap-4"></div>
                         <div class="flex justify-between mt-6">
                            <button type="button" class="prev-step-btn bg-gray-200 text-gray-800 font-semibold px-6 py-2 rounded-lg hover:bg-gray-300">Indietro</button>
                            <button type="submit" class="bg-green-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-green-700">Pubblica Annuncio</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Altre viste (Profilo, Casa Mia, etc.) vanno qui -->
        <div id="view-profile" ></div>
        <div id="view-my-home" ></div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- Inizializzazione Firebase (da incollare qui la config dal tuo progetto) ---
    // const firebaseConfig = { apiKey: "...", authDomain: "...", projectId: "...", ... };
    // firebase.initializeApp(firebaseConfig);
    // const auth = firebase.auth();
    // const db = firebase.firestore();
    // const storage = firebase.storage();
    // --- Fine Inizializzazione ---

    let listingsData = []; // Ora è vuoto, verrà riempito dal "database"

    const navLinksContainer = document.getElementById('nav-links');
    const views = document.querySelectorAll('[id^="view-"]');
    
    // --- Navigazione tra le Viste ---
    navLinksContainer.addEventListener('click', (e) => {
        if (e.target.tagName === 'A') {
            e.preventDefault();
            const viewName = e.target.getAttribute('href').substring(1);
            
            views.forEach(view => view.classList.remove('active'));
            document.getElementById(`view-${viewName}`).classList.add('active');

            navLinksContainer.querySelectorAll('a').forEach(link => link.classList.remove('active'));
            e.target.classList.add('active');
        }
    });

    // --- Logica del Form di Creazione Annuncio ---
    const createListingForm = document.getElementById('create-listing-form');
    const steps = document.querySelectorAll('.form-step');
    let currentStep = 0;

    function showStep(stepIndex) {
        steps.forEach((step, index) => {
            step.classList.toggle('active', index === stepIndex);
        });
    }

    createListingForm.addEventListener('click', function(e) {
        if (e.target.classList.contains('next-step-btn')) {
            currentStep++;
            showStep(currentStep);
        }
        if (e.target.classList.contains('prev-step-btn')) {
            currentStep--;
            showStep(currentStep);
        }
    });
    
    // Preview delle foto caricate
    const photoInput = document.getElementById('ad-photos');
    const photoPreview = document.getElementById('photo-preview');
    photoInput.addEventListener('change', function(e) {
        photoPreview.innerHTML = ''; // Pulisce la preview
        for (const file of e.target.files) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = document.createElement('img');
                img.src = event.target.result;
                img.className = 'w-full h-32 object-cover rounded-md border';
                photoPreview.appendChild(img);
            }
            reader.readAsDataURL(file);
        }
    });

    createListingForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        alert('Tentativo di pubblicare l\'annuncio!');
        
        const listingData = {
            title: document.getElementById('ad-title').value,
            description: document.getElementById('ad-description').value,
            type: document.getElementById('ad-type').value,
            price: parseInt(document.getElementById('ad-price').value),
            features: {
                wifi: document.getElementById('ad-wifi').checked,
                lavatrice: document.getElementById('ad-washing').checked,
                speseIncluse: document.getElementById('ad-bills').checked
            },
            // Altri dati come indirizzo, coordinate, etc.
            // Le foto andrebbero caricate prima di salvare i dati
        };

        // Qui chiameresti la funzione per salvare su Firebase
        await saveListingToFirebase(listingData); 
    });
    
    // --- Funzioni di Interazione con Firebase (Simulate) ---

    async function saveListingToFirebase(data) {
        console.log("Dati da salvare:", data);
        // Codice REALE con Firebase:
        // try {
        //   const docRef = await db.collection("listings").add(data);
        //   console.log("Document written with ID: ", docRef.id);
        //   alert("Annuncio pubblicato con successo!");
        //   // Qui potresti reindirizzare alla dashboard del proprietario
        // } catch (error) {
        //   console.error("Error adding document: ", error);
        //   alert("Errore nella pubblicazione dell'annuncio.");
        // }
        
        // Simulazione per il prototipo
        alert("Annuncio pubblicato con successo! (Simulazione)");
        // Aggiungo l'annuncio ai dati locali per vederlo subito
        const newListing = { ...data, id: Date.now(), images: ['https://placehold.co/600x400/16a34a/FFFFFF?text=Nuovo!'] };
        listingsData.push(newListing);
        renderListings(listingsData); // Aggiorno la vista studente
        // Torno alla vista di ricerca per vedere il risultato
        document.querySelector('a[href="#search"]').click();
    }


    async function fetchListingsFromDB() {
        console.log("Caricamento annunci dal database...");
        // Codice REALE con Firebase:
        // const querySnapshot = await db.collection("listings").get();
        // const listings = [];
        // querySnapshot.forEach((doc) => {
        //   listings.push({ id: doc.id, ...doc.data() });
        // });
        // return listings;
        
        // Dati di Esempio per il prototipo (se il DB fosse vuoto)
        return [
            { id: 1, title: "Stanza Singola Vicino al Campus", price: 450, type: "Stanza Singola", images: ['https://placehold.co/600x400/3b82f6/FFFFFF?text=Stanza+1'] },
            { id: 2, title: "Posto in Doppia Economico", price: 320, type: "Stanza Doppia", images: ['https://placehold.co/600x400/1e3a8a/FFFFFF?text=Stanza+2'] },
            { id: 3, title: "Monolocale Indipendente", price: 600, type: "Monolocale", images: ['https://placehold.co/600x400/60a5fa/FFFFFF?text=Monolocale'] }
        ];
    }
    
    function renderListings(listings) {
        const gridView = document.getElementById('grid-view');
        gridView.innerHTML = '';
        if (listings.length === 0) {
            gridView.innerHTML = `<p class="text-stone-500 col-span-full text-center">Nessun annuncio disponibile al momento.</p>`;
            return;
        }
        listings.forEach(listing => {
            const card = document.createElement('div');
            card.className = "bg-white rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-1 transition-transform duration-300";
            card.innerHTML = `
                <img src="${listing.images[0]}" alt="${listing.title}" class="w-full h-48 object-cover">
                <div class="p-4">
                    <p class="text-sm text-blue-600 font-semibold">${listing.type}</p>
                    <h3 class="text-lg font-bold text-stone-800 truncate mt-1">${listing.title}</h3>
                    <div class="flex justify-between items-center mt-4">
                        <p class="text-xl font-bold text-blue-700">€${listing.price}<span class="text-sm font-normal text-stone-500">/mese</span></p>
                    </div>
                </div>
            `;
            gridView.appendChild(card);
        });
    }

    // --- Inizializzazione dell'app ---
    async function initializeApp() {
        listingsData = await fetchListingsFromDB();
        renderListings(listingsData);
    }

    initializeApp();
});
</script>

</body>
</html>
